-- INF246 - BASES DE DATOS
-- 3ra. Práctica (Tipo B)
-- PARTE CALIFICADA
--
-- Solucionario propuesto
-- Autores: Carlos Arango Sáenz (preguntas 3, 4, 5) y Jorge Fatama Vera (preguntas 1, 2, 6, 7)

-- PREGUNTA 1 (Máximo: 2 puntos)
SELECT PRV.NOMBRE, COUNT(*) AS CANTIDAD_DISTRITOS
FROM GE_PROVINCIA PRV, GE_DISTRITO DIS
WHERE DIS.ID_PROVINCIA = PRV.ID_PROVINCIA
GROUP BY PRV.NOMBRE
HAVING COUNT(*) >= 12
ORDER BY 2 DESC, 1 ASC;

-- PREGUNTA 2 (Máximo: 3 puntos)
SELECT EVE.NOMBRE, COUNT(*) AS CANTIDAD, TRUNC(AVG(ACH.TAMANO)/1024,2) AS PROMEDIO_KB, TRUNC(MAX(ACH.TAMANO)/1024,2) AS ARCHIVO_MAXIMO_KB
FROM GE_EVENTO EVE, GE_ARCHIVO ACH
WHERE EVE.ID_EVENTO = ACH.ID_EVENTO AND EXISTS(
		SELECT *
		FROM GE_PERSONA PER, GE_PERSONA_EVENTO PEV
		WHERE PER.ID_PERSONA = PEV.ID_PERSONA AND PEV.ID_EVENTO = EVE.ID_EVENTO AND PEV.ASISTENCIA = 'A')
GROUP BY EVE.NOMBRE
ORDER BY 2 DESC, 3 DESC;

-- PREGUNTA 3 (Máximo: 4 puntos)
SELECT PER.NRO_DOCUMENTO, PER. APELLIDOS||',' ||PER.NOMBRES AS "APELLIDOS y NOMBRES", EVE.NOMBRE, PEV.ASISTENCIA
FROM GE_EVENTO EVE, GE_PERSONA_EVENTO PEV, GE_PERSONA PER
WHERE EVE.ID_EVENTO=PEV.ID_EVENTO AND PEV.ID_PERSONA=PER.ID_PERSONA AND PER.NOMBRES IN (
		SELECT PER1.NOMBRES
		FROM GE_PERSONA PER1, GE_EVENTO EVE1
		WHERE PER1.ID_PERSONA = EVE1.ID_RESPONSABLE AND EVE1.CARGO_RESPONSABLE = 'Director');

-- PREGUNTA 4 (Máximo: 3 puntos)
SELECT	EVE.NOMBRE, EVE.TEMA, DPT.NOMBRE AS DEPARTAMENTO
FROM GE_EVENTO EVE, GE_DEPARTAMENTO DPT, GE_PROVINCIA PRV, GE_DISTRITO DIS
WHERE EVE.UBIGEO = DIS.ID_DISTRITO AND DIS.ID_PROVINCIA = PRV.ID_PROVINCIA AND PRV.ID_DEPARTAMENTO = DPT.ID_DEPARTAMENTO
	AND (EVE.AFORO > (
		SELECT AVG(AFORO)
		FROM GE_EVENTO)
	OR EVE.AFORO > (
		SELECT AFORO
		FROM GE_EVENTO
		WHERE NOMBRE = 'Seminario I+D'));

-- PREGUNTA 5 (Máximo: 3 puntos)
SELECT ROWNUM AS POSICION, NOMBRE, TEMA, DISTRITO, AFORO 
FROM
		(SELECT	EVE.NOMBRE, EVE.TEMA, DIS.NOMBRE AS DISTRITO, EVE.AFORO
		FROM GE_EVENTO EVE, GE_PROVINCIA PRV, GE_DISTRITO DIS
		WHERE EVE.UBIGEO = DIS.ID_DISTRITO AND DIS.ID_PROVINCIA = PRV.ID_PROVINCIA AND PRV.NOMBRE <> 'HUARAZ'
		ORDER BY AFORO DESC)
WHERE ROWNUM <= 2;

-- PREGUNTA 6  (Máximo: 2.5 puntos)
SELECT DPT.NOMBRE AS DEPARTAMENTO, EVE.NOMBRE AS EVENTO
FROM GE_EVENTO EVE, GE_DISTRITO DIS, GE_PROVINCIA PRV, GE_DEPARTAMENTO DPT
WHERE EVE.UBIGEO = DIS.ID_DISTRITO AND DIS.ID_PROVINCIA = PRV.ID_PROVINCIA AND PRV.ID_DEPARTAMENTO = DPT.ID_DEPARTAMENTO AND EXISTS(
		SELECT *
		FROM GE_ARCHIVO ACH
		WHERE EVE.ID_EVENTO = ACH.ID_EVENTO AND ACH.TAMANO >= 153600)
ORDER BY 1, 2;

-- PREGUNTA 7 (Máximo: 2.5 puntos)
SELECT EVE.NOMBRE, COUNT(*) AS ASISTENTES
FROM GE_EVENTO EVE, GE_TIPO_EVENTO TIP, GE_CATEGORIA_EVENTO CAT, GE_PERSONA_EVENTO PEV
WHERE EVE.ID_TIPO_EVENTO = TIP.ID_TIPO_EVENTO AND TIP.ID_CATEGORIA_EVENTO = CAT.ID_CATEGORIA_EVENTO AND CAT.NOMBRE_CATEGORIA = 'Seminarios' AND PEV.ID_EVENTO = EVE.ID_EVENTO AND PEV.ASISTENCIA = 'A'
GROUP BY EVE.NOMBRE
ORDER BY 2 DESC, 1 ASC;